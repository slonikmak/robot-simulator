# Plan for Issue #8: Distinguish legs vs walls without map

Implement a firmware-side classifier that uses only the ultrasonic distance stream (HC-SR04-like) plus the robot’s own commanded motion to decide whether a nearby object is likely *moving legs* vs a static wall/obstacle.

Goal: The robot attacks only legs-like (moving) targets and does not enter AGGRESSION because of static walls/obstacles.

## Steps
- [ ] Add a small “target classifier” helper in `firmware.js` that tracks a short history of ultrasonic readings (recent samples + timestamps).
- [ ] Implement feature extraction on the history (e.g., distance variance, derivative/jerk, intermittency / dropouts to `Infinity`, persistence time under threshold).
- [ ] Add an **active-probing** routine (brief left/right micro-rotation) that runs only when an unknown close object is first detected; classify based on how readings change during the probe.
- [ ] Gate `AGGRESSION` entry on a legs-likelihood score (moving signature) instead of raw distance alone.
- [ ] Ensure false positives don’t create oscillations: add hysteresis/cooldown so the robot doesn’t flip states on single noisy samples.
- [ ] Manual smoke check: walls/obstacles don’t trigger attack; moving cursor legs do; stationary cursor should not trigger per spec (“moving object”).

## Acceptance
- When the robot faces a wall/obstacle at close distance, it does **not** enter `AGGRESSION` and does not get stuck in “attack loops”.
- When the cursor legs move near the robot/zone, robot enters `AGGRESSION` reliably within a short, consistent delay.
- The algorithm uses **no map** (no world geometry, no obstacle list) and does **not** change the ultrasonic sensor model/output.
- Firmware remains Arduino-portable: bounded memory, no heavy dependencies.

## Validation / Proof
- Start local server and reproduce 3 scenarios: (1) approach wall, (2) approach obstacle, (3) move legs near robot.
- Observe state transitions in the UI panel and confirm criteria above.

Spec: New requirement R-011 (see `spec.md`).
